/*!
 * image-process v0.0.1
 * (c) 2017-2017 dailc
 * Released under the MIT License.
 * https://github.com/dailc/image-process
 */
!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):t.ImageScale=a()}(this,function(){"use strict";function t(t,a,i,r,e,o){for(var n=e/a,h=o/i,d=r,f=0;f<e;f+=1)for(var v=0;v<o;v+=1)!function(r,o){var f=Math.min(a-1,r/n),v=Math.min(i-1,o/h),c=Math.floor(f),u=Math.floor(v),m=o*e+r,g=u*a+c;m*=4,g*=4;for(var s=0;s<=3;s+=1)d[m+s]=t[g+s]}(f,v)}function a(a,i){return t(a.data,a.width,a.height,i.data,i.width,i.height),i}function i(t,a,i,r,e){var o=r,n=e;o>=i?o=i-1:o<0&&(o=0),n>=a?n=a-1:n<0&&(n=0);var h=o*a+n;return h*=4,[t[h+0],t[h+1],t[h+2],t[h+3]]}function r(t,a,r,e,o,n){for(var h=o/a,d=n/r,f=e,v=0;v<o;v+=1)for(var c=0;c<n;c+=1)!function(e,n){var v=Math.min(a-1,e/h),c=Math.min(r-1,n/d),u=Math.floor(v),m=Math.floor(c),g=v-u,s=c-m,w=1-g,l=1-s,M=n*o+e;M*=4;for(var p=i(t,a,r,m+0,u+0),x=i(t,a,r,m+0,u+1),I=i(t,a,r,m+1,u+0),y=i(t,a,r,m+1,u+1),D=0;D<=3;D+=1){var R=s*(w*I[D]+g*y[D]),S=l*(w*p[D]+g*x[D]);f[M+D]=R+S}}(v,c)}function e(t,a){return r(t.data,t.width,t.height,a.data,a.width,a.height),a}function o(t,a,i,r,e,o){for(var n=r,h=e/a,d=o/i,f=0;f<e;f+=1)for(var v=0;v<o;v+=1)!function(r,o){var f=Math.min(a-1,r/h),v=Math.min(i-1,o/d),c=Math.floor(f),u=Math.floor(v),m=f-c,g=v-u,s=o*e+r;s*=4;for(var w=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],l=0;l<=3;l+=1){for(var M=-1;M<=2;M+=1)for(var p=-1;p<=2;p+=1)w[M+1][p+1]=U(t,a,i,u+M,c+p,l);b(w),n[s+l]=j(q(g,m))}}(f,v)}function n(t,a){return o(t.data,t.width,t.height,a.data,a.width,a.height),a}function h(t){var a=t>=0?t:-t,i=t*t,r=a*i;return a<=1?1-(z+3)*i+(z+2)*r:a<=2?-4*z+8*z*a-5*z*i+z*r:0}function d(t){var a=t;return a=Math.min(255,a),a=Math.max(0,a)}function f(t,a,i,r,e){var o=r,n=e;o>=i?o=i-1:o<0&&(o=0),n>=a?n=a-1:n<0&&(n=0);var h=o*a+n;return h*=4,[t[h+0],t[h+1],t[h+2],t[h+3]]}function v(t,a,i,r,e,o){for(var n=r,v=e/a,c=o/i,u=0;u<e;u+=1)for(var m=0;m<o;m+=1)!function(r,o){var u=Math.min(a-1,r/v),m=Math.min(i-1,o/c),g=Math.floor(u),s=Math.floor(m),w=u-g,l=m-s,M=o*e+r;M*=4;for(var p=[0,0,0,0],x=-1;x<=2;x+=1)for(var I=-1;I<=2;I+=1){var y=f(t,a,i,s+x,g+I),D=h(x-l)*h(I-w);p[0]+=y[0]*D,p[1]+=y[1]*D,p[2]+=y[2]*D,p[3]+=y[3]*D}n[M+0]=d(p[0]),n[M+1]=d(p[1]),n[M+2]=d(p[2]),n[M+3]=d(p[3])}(u,m)}function c(t,a){return v(t.data,t.width,t.height,a.data,a.width,a.height),a}function u(t){for(var a=t,i=arguments.length,r=Array(i>1?i-1:0),e=1;e<i;e++)r[e-1]=arguments[e];return r.forEach(function(t){t&&Object.keys(t).forEach(function(i){a[i]=t[i]})}),a}var m=void 0,g=void 0,s=void 0,w=void 0,l=void 0,M=void 0,p=void 0,x=void 0,I=void 0,y=void 0,D=void 0,R=void 0,S=void 0,W=void 0,E=void 0,O=void 0,U=function(t,a,i,r,e,o){var n=r,h=e;n>=i?n=i-1:n<0&&(n=0),h>=a?h=a-1:h<0&&(h=0);var d=n*a+h;return d*=4,t[d+o]},j=function(t){var a=t;return a=Math.min(255,a),a=Math.max(0,a)},b=function(t){var a=t;m=a[1][1],g=-.5*a[1][0]+.5*a[1][2],s=a[1][0]-2.5*a[1][1]+2*a[1][2]-.5*a[1][3],w=-.5*a[1][0]+1.5*a[1][1]-1.5*a[1][2]+.5*a[1][3],l=-.5*a[0][1]+.5*a[2][1],M=.25*a[0][0]-.25*a[0][2]-.25*a[2][0]+.25*a[2][2],p=-.5*a[0][0]+1.25*a[0][1]-a[0][2]+.25*a[0][3]+.5*a[2][0]-1.25*a[2][1]+a[2][2]-.25*a[2][3],x=.25*a[0][0]-.75*a[0][1]+.75*a[0][2]-.25*a[0][3]-.25*a[2][0]+.75*a[2][1]-.75*a[2][2]+.25*a[2][3],I=a[0][1]-2.5*a[1][1]+2*a[2][1]-.5*a[3][1],y=-.5*a[0][0]+.5*a[0][2]+1.25*a[1][0]-1.25*a[1][2]-a[2][0]+a[2][2]+.25*a[3][0]-.25*a[3][2],D=a[0][0]-2.5*a[0][1]+2*a[0][2]-.5*a[0][3]-2.5*a[1][0]+6.25*a[1][1]-5*a[1][2]+1.25*a[1][3]+2*a[2][0]-5*a[2][1]+4*a[2][2]-a[2][3]-.5*a[3][0]+1.25*a[3][1]-a[3][2]+.25*a[3][3],R=-.5*a[0][0]+1.5*a[0][1]-1.5*a[0][2]+.5*a[0][3]+1.25*a[1][0]-3.75*a[1][1]+3.75*a[1][2]-1.25*a[1][3]-a[2][0]+3*a[2][1]-3*a[2][2]+a[2][3]+.25*a[3][0]-.75*a[3][1]+.75*a[3][2]-.25*a[3][3],S=-.5*a[0][1]+1.5*a[1][1]-1.5*a[2][1]+.5*a[3][1],W=.25*a[0][0]-.25*a[0][2]-.75*a[1][0]+.75*a[1][2]+.75*a[2][0]-.75*a[2][2]-.25*a[3][0]+.25*a[3][2],E=-.5*a[0][0]+1.25*a[0][1]-a[0][2]+.25*a[0][3]+1.5*a[1][0]-3.75*a[1][1]+3*a[1][2]-.75*a[1][3]-1.5*a[2][0]+3.75*a[2][1]-3*a[2][2]+.75*a[2][3]+.5*a[3][0]-1.25*a[3][1]+a[3][2]-.25*a[3][3],O=.25*a[0][0]-.75*a[0][1]+.75*a[0][2]-.25*a[0][3]-.75*a[1][0]+2.25*a[1][1]-2.25*a[1][2]+.75*a[1][3]+.75*a[2][0]-2.25*a[2][1]+2.25*a[2][2]-.75*a[2][3]-.25*a[3][0]+.75*a[3][1]-.75*a[3][2]+.25*a[3][3]},q=function(t,a){var i=t*t,r=a*a,e=r*a;return m+g*a+s*r+w*e+(l+M*a+p*r+x*e)*t+(I+y*a+D*r+R*e)*i+(S+W*a+E*r+O*e)*(i*t)},z=-1,A={width:80,height:80,mime:"image/png",processType:1},C={quality:.92,mime:"image/jpeg",compressScaleRatio:1,iphoneFixedRatio:2,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},F={};return function(t){var i=t;i.scaleImageData=function(t,i,r){(0,[a,e,n,c][u({},A,r).processType])(t,i)},i.scaleImage=function(t,a){var r=t.width,e=t.height,o=u({},A,a),n=document.createElement("canvas"),h=n.getContext("2d");n.width=r,n.height=e,h.drawImage(t,0,0,r,e);var d=h.getImageData(0,0,r,e),f=h.createImageData(o.width,o.height);return i.scaleImageData(d,f,o),n.width=f.width,n.height=f.height,h.putImageData(f,0,0,0,0,n.width,n.height),n.toDataURL(o.mime,.9)},i.compressImage=function(t,a){var i=t.width,r=t.height,e=i/r,o=u({},C,a),n=document.createElement("canvas"),h=n.getContext("2d"),d=window.devicePixelRatio||1;d*=o.compressScaleRatio||1,navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)&&(d*=o.iphoneFixedRatio||1);var f=window.innerWidth*d;(o.isUseOriginSize||f>i)&&(f=i);var v=o.maxWidth;v&&i>v&&f>v&&(f=v);var c=o.forceWidth,m=o.forceHeight;c&&(f=c);var g=f/e;return m&&(g=m),n.width=f,n.height=g,h.drawImage(t,0,0,i,r,0,0,n.width,n.height),n.toDataURL(o.mime,o.quality)}}(F),F});