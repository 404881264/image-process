/*!
 * image-process v0.0.1
 * (c) 2017-2017 dailc
 * Released under the MIT License.
 * https://github.com/dailc/image-process
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.ImageProcess=i()}(this,function(){"use strict";function t(t){for(var i=t,s=arguments.length,e=Array(s>1?s-1:0),a=1;a<s;a++)e[a-1]=arguments[a];return e.forEach(function(t){t&&Object.keys(t).forEach(function(s){i[s]=t[s]})}),i}function i(t){var i=t;return"string"==typeof i&&(i=document.querySelector(i)),i}function s(t){(function(t){this.os={};var i=t.match(/(Android);?[\s/]+([\d.]+)?/);i&&(this.os.android=!0,this.os.version=i[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));var s=t.match(/(iPhone\sOS)\s([\d_]+)/);s&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=s[2].replace(/_/g,"."));var e=t.match(/(iPad).*OS\s([\d_]+)/);e&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=e[2].replace(/_/g,"."));var a=t.match(/QuickHybrid/i);a&&(this.os.quick=!0);var h=t.match(/EpointEJS/i);h&&(this.os.ejs=!0);var n=t.match(/DingTalk/i);n&&(this.os.dd=!0),h||n||a||(this.os.h5=!0)}).call(t,navigator.userAgent)}function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function a(t,i,s,e,a,h){for(var n=a/i,c=h/s,o=e,r=0;r<a;r+=1)for(var l=0;l<h;l+=1)!function(e,h){var r=Math.min(i-1,e/n),l=Math.min(s-1,h/c),v=Math.floor(r),d=Math.floor(l),u=h*a+e,g=d*i+v;u*=4,g*=4;for(var f=0;f<=3;f+=1)o[u+f]=t[g+f]}(r,l)}function h(t,i){return a(t.data,t.width,t.height,i.data,i.width,i.height),i}function n(t,i,s,e,a){var h=e,n=a;h>=s?h=s-1:h<0&&(h=0),n>=i?n=i-1:n<0&&(n=0);var c=h*i+n;return c*=4,[t[c+0],t[c+1],t[c+2],t[c+3]]}function c(t,i,s,e,a,h){for(var c=a/i,o=h/s,r=e,l=0;l<a;l+=1)for(var v=0;v<h;v+=1)!function(e,h){var l=Math.min(i-1,e/c),v=Math.min(s-1,h/o),d=Math.floor(l),u=Math.floor(v),g=l-d,f=v-u,p=1-g,m=1-f,w=h*a+e;w*=4;for(var x=n(t,i,s,u+0,d+0),R=n(t,i,s,u+0,d+1),F=n(t,i,s,u+1,d+0),S=n(t,i,s,u+1,d+1),M=0;M<=3;M+=1){var T=f*(p*F[M]+g*S[M]),y=m*(p*x[M]+g*R[M]);r[w+M]=T+y}}(l,v)}function o(t,i){return c(t.data,t.width,t.height,i.data,i.width,i.height),i}function r(t,i,s,e,a,h){for(var n=e,c=a/i,o=h/s,r=0;r<a;r+=1)for(var l=0;l<h;l+=1)!function(e,h){var r=Math.min(i-1,e/c),l=Math.min(s-1,h/o),v=Math.floor(r),d=Math.floor(l),u=r-v,g=l-d,f=h*a+e;f*=4;for(var p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=0;m<=3;m+=1){for(var w=-1;w<=2;w+=1)for(var x=-1;x<=2;x+=1)p[w+1][x+1]=O(t,i,s,d+w,v+x,m);b(p),n[f+m]=W(A(g,u))}}(r,l)}function l(t,i){return r(t.data,t.width,t.height,i.data,i.width,i.height),i}function v(t){var i=t>=0?t:-t,s=t*t,e=i*s;return i<=1?1-(_+3)*s+(_+2)*e:i<=2?-4*_+8*_*i-5*_*s+_*e:0}function d(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)}function u(t,i,s,e,a){var h=e,n=a;h>=s?h=s-1:h<0&&(h=0),n>=i?n=i-1:n<0&&(n=0);var c=h*i+n;return c*=4,[t[c+0],t[c+1],t[c+2],t[c+3]]}function g(t,i,s,e,a,h){for(var n=e,c=a/i,o=h/s,r=0;r<a;r+=1)for(var l=0;l<h;l+=1)!function(e,h){var r=Math.min(i-1,e/c),l=Math.min(s-1,h/o),g=Math.floor(r),f=Math.floor(l),p=r-g,m=l-f,w=h*a+e;w*=4;for(var x=[0,0,0,0],R=-1;R<=2;R+=1)for(var F=-1;F<=2;F+=1){var S=u(t,i,s,f+R,g+F),M=v(R-m)*v(F-p);x[0]+=S[0]*M,x[1]+=S[1]*M,x[2]+=S[2]*M,x[3]+=S[3]*M}n[w+0]=d(x[0]),n[w+1]=d(x[1]),n[w+2]=d(x[2]),n[w+3]=d(x[3])}(r,l)}function f(t,i){return g(t.data,t.width,t.height,i.data,i.width,i.height),i}var p=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),m={container:"#imgclip",img:null,isSmooth:!0,captureRadius:30,quality:.92,mime:"image/jpeg",maxCssHeight:0,sizeTipsStyle:0,compressScaleRatio:1,iphoneFixedRatio:2,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},w=function(){function a(h){e(this,a),s(this),this.options=t({},m,h),this.container=i(this.options.container),this.img=this.options.img,this.domChildren=[],this.events={},this.initCanvas(),this.initClip(),this.initMagnifier(),this.initTransferCanvas(),this.resetClipRect()}return p(a,[{key:"getPixelRatio",value:function(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,s=(window.devicePixelRatio||1)/i;return s*=this.options.compressScaleRatio||1,this.os.ios&&this.os.iphone&&(s*=this.options.iphoneFixedRatio||1),s}},{key:"clear",value:function(){for(var t=this.domChildren&&this.domChildren.length||0,i=0;i<t;i+=1)this.container.removeChild(this.domChildren[i]);this.domChildren=null;for(var s=Object.keys(this.events||{}),e=s&&s.length||0,a=0;a<e;a+=1)this.container.removeEventListener(s[a],this.events[s[a]]);this.events=null}},{key:"initCanvas",value:function(){this.canvasFull=document.createElement("canvas"),this.ctxFull=this.canvasFull.getContext("2d"),this.canvasFull.className="clip-canvas-full",this.smoothCtx(this.ctxFull),this.RATIO_PIXEL=this.getPixelRatio(this.ctxFull);var t=this.img.width/this.img.height,i=this.container.offsetWidth||window.innerWidth;this.oldWidth=i,this.oldHeight=i/t,this.resizeCanvas(i,this.oldHeight),this.container.appendChild(this.canvasFull),this.domChildren.push(this.canvasFull)}},{key:"resizeCanvas",value:function(t,i){var s=this.options.maxCssHeight,e=t/i,a=this.oldWidth,h=a/e;s&&h>s&&(a=(h=s)*e),this.marginLeft=(this.oldWidth-a)/2,this.canvasFull.style.width=a+"px",this.canvasFull.style.height=h+"px",this.canvasFull.style.marginLeft=this.marginLeft+"px",this.canvasFull.width=a*this.RATIO_PIXEL,this.canvasFull.height=h*this.RATIO_PIXEL,1&this.rotateStep?this.scale=this.canvasFull.width/this.img.height:this.scale=this.canvasFull.width/this.img.width}},{key:"initClip",value:function(){var t=document.createElement("div");t.className="clip-rect",this.clipRect=t,this.container.appendChild(this.clipRect),this.domChildren.push(this.clipRect);var i=document.createElement("span");i.className="clip-tips",this.clipRect.appendChild(i),this.clipTips=i,-1!==this.options.sizeTipsStyle&&0!==this.options.sizeTipsStyle||this.clipTips.classList.add("clip-hidden"),this.clipRectHorns=[];for(var s=0;s<8;s+=1){var e=document.createElement("span");e.className="clip-rect-horn ",0===s?e.className+="horn-nw":1===s?e.className+="horn-ne":2===s?e.className+="horn-sw":3===s?e.className+="horn-se":4===s?e.className+="horn-n":5===s?e.className+="horn-s":6===s?e.className+="horn-w":7===s&&(e.className+="horn-e"),this.clipRect.appendChild(e),this.clipRectHorns.push(e)}this.resizeClip()}},{key:"resizeClip",value:function(){var t=this;this.clipEventState={};var i=function(i){t.clipEventState.width=t.clipRect.offsetWidth,t.clipEventState.height=t.clipRect.offsetHeight,t.clipEventState.left=t.clipRect.offsetLeft-t.marginLeft,t.clipEventState.top=t.clipRect.offsetTop,t.clipEventState.mouseX=i.touches?i.touches[0].pageX:i.pageX,t.clipEventState.mouseY=i.touches?i.touches[0].pageY:i.pageY,t.clipEventState.evnt=i},s=function(i,s){var e=s-t.canvasFull.offsetTop-t.container.offsetTop,a=i-t.canvasFull.offsetLeft-t.container.offsetLeft;return e=Math.min(e,t.canvasFull.offsetHeight),e=Math.max(0,e),a=Math.min(a,t.canvasFull.offsetWidth),a=Math.max(0,a),t.curX=a,t.curY=e,{curX:a,curY:e}},e=function(i){if(t.canResizing){i.preventDefault(),i.stopPropagation();var e=t.clipEventState,a=e.evnt.target,h=i.touches?i.touches[0].pageY:i.pageY,n=i.touches?i.touches[0].pageX:i.pageX,c=s(n,h),o=c.curX,r=c.curY,l=void 0,v=void 0,d=void 0,u=void 0;a.classList.contains("horn-nw")?(l=e.width-(o-e.left),v=e.height-(r-e.top),d=o,u=r):a.classList.contains("horn-ne")?(l=o-e.left,v=e.height-(r-e.top),d=e.left,u=r):a.classList.contains("horn-sw")?(l=e.width-(o-e.left),v=r-e.top,d=o,u=e.top):a.classList.contains("horn-se")?(l=o-e.left,v=r-e.top,d=e.left,u=e.top):a.classList.contains("horn-n")?(l=e.width,v=e.height-(r-e.top),d=e.left,u=r):a.classList.contains("horn-s")?(l=e.width,v=r-e.top,d=e.left,u=e.top):a.classList.contains("horn-w")?(l=e.width-(o-e.left),v=e.height,d=o,u=e.top):a.classList.contains("horn-e")&&(l=o-e.left,v=e.height,d=o-l,u=e.top),t.clipRect.style.left=d+t.marginLeft+"px",t.clipRect.style.top=u+"px",t.clipRect.style.width=l+"px",t.clipRect.style.height=v+"px",t.draw()}};this.container.addEventListener("touchmove",e),this.container.addEventListener("mousemove",e),this.events.touchmove=e,this.events.mousemove=e;for(var a=function(s){t.canResizing=!0,t.canvasMag.classList.remove("clip-hidden"),0===t.options.sizeTipsStyle&&t.clipTips.classList.remove("clip-hidden"),i(s)},h=function(){t.canResizing=!1,t.canvasMag.classList.add("clip-hidden"),0===t.options.sizeTipsStyle&&t.clipTips.classList.add("clip-hidden")},n=0;n<8;n+=1)this.clipRectHorns[n].addEventListener("mousedown",a),this.clipRectHorns[n].addEventListener("touchstart",a),this.clipRectHorns[n].addEventListener("mouseup",h),this.clipRectHorns[n].addEventListener("touchend",h);this.container.addEventListener("mouseleave",h),this.container.addEventListener("mouseup",h),this.events.mouseleave=h,this.events.mouseup=h}},{key:"draw",value:function(){this.drawMag();var t=this.getRealFinalImgSize(this.clipRect.offsetWidth*this.RATIO_PIXEL,this.clipRect.offsetHeight*this.RATIO_PIXEL),i=t.width,s=t.height;this.clipTips.innerText=i.toFixed(0)+"*"+s.toFixed(0),this.ctxFull.save(),1&this.rotateStep?this.ctxFull.clearRect(0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.clearRect(0,0,this.canvasFull.width,this.canvasFull.height),this.drawImage(),this.drawMask(),this.ctxFull.beginPath();var e=this.getClipRectParams(),a=e.srcX,h=e.srcY,n=e.sWidth,c=e.sHeight;this.ctxFull.rect(a,h,n,c),this.ctxFull.clip(),this.drawImage(),this.ctxFull.restore()}},{key:"getClipRectParams",value:function(){var t=this.clipRect.offsetTop,i=this.clipRect.offsetLeft-this.marginLeft,s=this.clipRect.offsetWidth,e=this.clipRect.offsetHeight,a=i+s,h=t+e,n=i,c=t,o=s,r=e;return 1===this.rotateStep?(n=t,c=this.canvasFull.offsetWidth-a,o=e,r=s):2===this.rotateStep?(n=this.canvasFull.offsetWidth-a,c=this.canvasFull.offsetHeight-h,o=s,r=e):3===this.rotateStep&&(n=this.canvasFull.offsetHeight-h,c=i,o=e,r=s),n*=this.RATIO_PIXEL,c*=this.RATIO_PIXEL,o*=this.RATIO_PIXEL,r*=this.RATIO_PIXEL,{srcX:n,srcY:c,sWidth:o,sHeight:r}}},{key:"getRealCoordinate",value:function(t,i){var s=t,e=i;return 1===this.rotateStep?(s=i,e=this.canvasFull.offsetWidth-t):2===this.rotateStep?(s=this.canvasFull.offsetWidth-t,e=this.canvasFull.offsetHeight-i):3===this.rotateStep&&(s=this.canvasFull.offsetHeight-i,e=t),s*=this.RATIO_PIXEL,e*=this.RATIO_PIXEL,{x:s,y:e}}},{key:"drawImage",value:function(){1&this.rotateStep?this.ctxFull.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvasFull.width,this.canvasFull.height)}},{key:"drawMask",value:function(){this.ctxFull.save(),this.ctxFull.fillStyle="rgba(0, 0, 0, 0.3)",1&this.rotateStep?this.ctxFull.fillRect(0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.fillRect(0,0,this.canvasFull.width,this.canvasFull.height),this.ctxFull.restore()}},{key:"drawMag",value:function(){var t=this.options.captureRadius,i=this.getRealCoordinate(this.curX,this.curY),s=2*t,e=2*t,a=i.x-t,h=i.y-t;1&this.rotateStep?this.ctxMag.clearRect(0,0,this.canvasMag.height,this.canvasMag.width):this.ctxMag.clearRect(0,0,this.canvasMag.width,this.canvasMag.height);var n=0,c=0;this.os.ios&&(h<0&&(c=this.canvasMag.height/2*Math.abs(h/t),h=0),a<0&&(n=this.canvasMag.width/2*Math.abs(a/t),a=0)),this.ctxMag.drawImage(this.img,a/this.scale,h/this.scale,s/this.scale,e/this.scale,n,c,this.canvasMag.width,this.canvasMag.height);var o=this.canvasMag.width/2,r=this.canvasMag.height/2,l=5*this.RATIO_PIXEL;this.ctxMag.beginPath(),this.ctxMag.moveTo(o-l,r),this.ctxMag.lineTo(o+l,r),this.ctxMag.moveTo(o,r-l),this.ctxMag.lineTo(o,r+l),this.ctxMag.strokeStyle="#de3c50",this.ctxMag.lineWidth=3,this.ctxMag.stroke()}},{key:"initMagnifier",value:function(){this.canvasMag=document.createElement("canvas"),this.canvasMag.className="magnifier clip-hidden",this.ctxMag=this.canvasMag.getContext("2d"),this.smoothCtx(this.ctxMag),this.container.appendChild(this.canvasMag),this.domChildren.push(this.canvasMag),this.canvasMag.width=2*this.options.captureRadius*this.RATIO_PIXEL,this.canvasMag.height=2*this.options.captureRadius*this.RATIO_PIXEL}},{key:"initTransferCanvas",value:function(){this.canvasTransfer=document.createElement("canvas"),this.canvasTransfer.style.display="none",this.canvasTransfer.className="transfer-canvas",this.ctxTransfer=this.canvasTransfer.getContext("2d"),this.smoothCtx(this.ctxTransfer),this.container.appendChild(this.canvasTransfer),this.domChildren.push(this.canvasTransfer)}},{key:"smoothCtx",value:function(t){var i=this.options.isSmooth;t.mozImageSmoothingEnabled=i,t.webkitImageSmoothingEnabled=i,t.msImageSmoothingEnabled=i,t.imageSmoothingEnabled=i}},{key:"getRealFinalImgSize",value:function(t,i){var s=this.canvasFull.width/this.canvasFull.height,e=this.options.maxWidth||0,a=this.options.forceWidth||0,h=this.options.forceHeight||0,n=t,c=i;return 1&this.rotateStep?((this.options.isUseOriginSize||this.canvasFull.width>this.img.height)&&(n=this.img.width*t/this.canvasFull.height,c=this.img.height*i/this.canvasFull.width),e&&this.canvasFull.height>e&&e<this.img.height&&(n=e*t/this.canvasFull.height,c=e/s*i/this.canvasFull.width),a&&(n=a*t/this.canvasFull.height,c=(h||a/s)*i/this.canvasFull.width)):((this.options.isUseOriginSize||this.canvasFull.width>this.img.width)&&(n=this.img.width*t/this.canvasFull.width,c=this.img.height*i/this.canvasFull.height),e&&this.canvasFull.width>e&&e<this.img.width&&(n=e*t/this.canvasFull.width,c=e/s*i/this.canvasFull.height),a&&(n=a*t/this.canvasFull.width,c=(h||a/s)*i/this.canvasFull.height)),{width:n,height:c}}},{key:"clip",value:function(){var t=this.getClipRectParams(),i=t.srcX,s=t.srcY,e=t.sWidth,a=t.sHeight,h=this.getRealFinalImgSize(e,a),n=h.width,c=h.height;this.rotateStep=this.rotateStep||0;var o=90*this.rotateStep*Math.PI/180;0===this.rotateStep?(this.canvasTransfer.width=n,this.canvasTransfer.height=c):1===this.rotateStep?(this.canvasTransfer.width=c,this.canvasTransfer.height=n,this.ctxTransfer.rotate(o),this.ctxTransfer.translate(0,-this.canvasTransfer.width)):2===this.rotateStep?(this.canvasTransfer.width=n,this.canvasTransfer.height=c,this.ctxTransfer.rotate(o),this.ctxTransfer.translate(-this.canvasTransfer.width,-this.canvasTransfer.height)):3===this.rotateStep&&(this.canvasTransfer.width=c,this.canvasTransfer.height=n,this.ctxTransfer.rotate(o),this.ctxTransfer.translate(-this.canvasTransfer.height,0)),1&this.rotateStep?this.ctxTransfer.drawImage(this.img,i/this.scale,s/this.scale,e/this.scale,a/this.scale,0,0,this.canvasTransfer.height,this.canvasTransfer.width):this.ctxTransfer.drawImage(this.img,i/this.scale,s/this.scale,e/this.scale,a/this.scale,0,0,this.canvasTransfer.width,this.canvasTransfer.height),this.clipImgData=this.canvasTransfer.toDataURL(this.options.mime,this.options.quality)}},{key:"resetClipRect",value:function(){this.clipRect.style.left=(this.marginLeft||0)+"px",this.clipRect.style.top=0,this.clipRect.style.width=this.canvasFull.width/this.RATIO_PIXEL+"px",this.clipRect.style.height=this.canvasFull.height/this.RATIO_PIXEL+"px",this.draw()}},{key:"getClipImgData",value:function(){return this.clipImgData}},{key:"rotate",value:function(t){var i=this.oldWidth,s=this.oldHeight;this.rotateStep=this.rotateStep||0,this.rotateStep+=t?1:-1,this.rotateStep>3?this.rotateStep=0:this.rotateStep<0&&(this.rotateStep=3);var e=90*this.rotateStep*Math.PI/180;this.canvasMag.width=this.canvasMag.width,this.canvasMag.height=this.canvasMag.height,0===this.rotateStep?this.resizeCanvas(i,s):1===this.rotateStep?(this.resizeCanvas(s,i),this.ctxFull.rotate(e),this.ctxFull.translate(0,-this.canvasFull.width),this.ctxMag.rotate(e),this.ctxMag.translate(0,-this.canvasMag.width)):2===this.rotateStep?(this.resizeCanvas(i,s),this.ctxFull.rotate(e),this.ctxFull.translate(-this.canvasFull.width,-this.canvasFull.height),this.ctxMag.rotate(e),this.ctxMag.translate(-this.canvasMag.width,-this.canvasMag.height)):3===this.rotateStep&&(this.resizeCanvas(s,i),this.ctxFull.rotate(e),this.ctxFull.translate(-this.canvasFull.height,0),this.ctxMag.rotate(e),this.ctxMag.translate(-this.canvasMag.height,0)),this.resetClipRect()}},{key:"destroy",value:function(){this.clear(),this.canvasFull=null,this.ctxFull=null,this.canvasTransfer=null,this.ctxTransfer=null,this.canvasMag=null,this.ctxMag=null,this.clipRect=null}}]),a}(),x=void 0,R=void 0,F=void 0,S=void 0,M=void 0,T=void 0,y=void 0,I=void 0,C=void 0,L=void 0,E=void 0,k=void 0,P=void 0,X=void 0,z=void 0,H=void 0,O=function(t,i,s,e,a,h){var n=e,c=a;n>=s?n=s-1:n<0&&(n=0),c>=i?c=i-1:c<0&&(c=0);var o=n*i+c;return o*=4,t[o+h]},W=function(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)},b=function(t){var i=t;x=i[1][1],R=-.5*i[1][0]+.5*i[1][2],F=i[1][0]-2.5*i[1][1]+2*i[1][2]-.5*i[1][3],S=-.5*i[1][0]+1.5*i[1][1]-1.5*i[1][2]+.5*i[1][3],M=-.5*i[0][1]+.5*i[2][1],T=.25*i[0][0]-.25*i[0][2]-.25*i[2][0]+.25*i[2][2],y=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+.5*i[2][0]-1.25*i[2][1]+i[2][2]-.25*i[2][3],I=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.25*i[2][0]+.75*i[2][1]-.75*i[2][2]+.25*i[2][3],C=i[0][1]-2.5*i[1][1]+2*i[2][1]-.5*i[3][1],L=-.5*i[0][0]+.5*i[0][2]+1.25*i[1][0]-1.25*i[1][2]-i[2][0]+i[2][2]+.25*i[3][0]-.25*i[3][2],E=i[0][0]-2.5*i[0][1]+2*i[0][2]-.5*i[0][3]-2.5*i[1][0]+6.25*i[1][1]-5*i[1][2]+1.25*i[1][3]+2*i[2][0]-5*i[2][1]+4*i[2][2]-i[2][3]-.5*i[3][0]+1.25*i[3][1]-i[3][2]+.25*i[3][3],k=-.5*i[0][0]+1.5*i[0][1]-1.5*i[0][2]+.5*i[0][3]+1.25*i[1][0]-3.75*i[1][1]+3.75*i[1][2]-1.25*i[1][3]-i[2][0]+3*i[2][1]-3*i[2][2]+i[2][3]+.25*i[3][0]-.75*i[3][1]+.75*i[3][2]-.25*i[3][3],P=-.5*i[0][1]+1.5*i[1][1]-1.5*i[2][1]+.5*i[3][1],X=.25*i[0][0]-.25*i[0][2]-.75*i[1][0]+.75*i[1][2]+.75*i[2][0]-.75*i[2][2]-.25*i[3][0]+.25*i[3][2],z=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+1.5*i[1][0]-3.75*i[1][1]+3*i[1][2]-.75*i[1][3]-1.5*i[2][0]+3.75*i[2][1]-3*i[2][2]+.75*i[2][3]+.5*i[3][0]-1.25*i[3][1]+i[3][2]-.25*i[3][3],H=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.75*i[1][0]+2.25*i[1][1]-2.25*i[1][2]+.75*i[1][3]+.75*i[2][0]-2.25*i[2][1]+2.25*i[2][2]-.75*i[2][3]-.25*i[3][0]+.75*i[3][1]-.75*i[3][2]+.25*i[3][3]},A=function(t,i){var s=t*t,e=i*i,a=e*i;return x+R*i+F*e+S*a+(M+T*i+y*e+I*a)*t+(C+L*i+E*e+k*a)*s+(P+X*i+z*e+H*a)*(s*t)},_=-1,N={width:80,height:80,mime:"image/png",processType:1},D={quality:.92,mime:"image/jpeg",compressScaleRatio:1,iphoneFixedRatio:1.5,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},Y={};return function(i){function s(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/i}var e=i;e.scaleImageData=function(i,s,e){(0,[h,o,l,f][t({},N,e).processType])(i,s)},e.scaleImage=function(i,s){var a=i.width,h=i.height,n=t({},N,s),c=document.createElement("canvas"),o=c.getContext("2d");c.width=a,c.height=h,o.drawImage(i,0,0,a,h);var r=o.getImageData(0,0,a,h),l=o.createImageData(n.width,n.height);return e.scaleImageData(r,l,n),c.width=l.width,c.height=l.height,o.putImageData(l,0,0,0,0,c.width,c.height),c.toDataURL(n.mime,.9)},e.compressImage=function(i,e){var a=i.width,h=i.height,n=a/h,c=t({},D,e),o=document.createElement("canvas"),r=o.getContext("2d"),l=s(r);l*=c.compressScaleRatio||1,navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)&&(l*=c.iphoneFixedRatio||1);var v=window.innerWidth*l;(c.isUseOriginSize||v>a)&&(v=a);var d=c.maxWidth;d&&a>d&&v>d&&(v=d);var u=c.forceWidth,g=c.forceHeight;u&&(v=u);var f=v/n;return g&&(f=g),o.width=v,o.height=f,r.drawImage(i,0,0,a,h,0,0,o.width,o.height),o.toDataURL(c.mime,c.quality)}}(Y),Y.ImgClip=w,Y});