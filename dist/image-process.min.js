/*!
 * image-process v0.0.1
 * (c) 2017-2017 dailc
 * Released under the MIT License.
 * https://github.com/dailc/image-process
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.ImageProcess=i()}(this,function(){"use strict";function t(t){for(var i=t,s=arguments.length,a=Array(s>1?s-1:0),e=1;e<s;e++)a[e-1]=arguments[e];return a.forEach(function(t){t&&Object.keys(t).forEach(function(s){i[s]=t[s]})}),i}function i(t){var i=t;return"string"==typeof i&&(i=document.querySelector(i)),i}function s(t){(function(t){this.os={};var i=t.match(/(Android);?[\s/]+([\d.]+)?/);i&&(this.os.android=!0,this.os.version=i[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));var s=t.match(/(iPhone\sOS)\s([\d_]+)/);s&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=s[2].replace(/_/g,"."));var a=t.match(/(iPad).*OS\s([\d_]+)/);a&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=a[2].replace(/_/g,"."));var e=t.match(/QuickHybrid/i);e&&(this.os.quick=!0);var h=t.match(/EpointEJS/i);h&&(this.os.ejs=!0);var n=t.match(/DingTalk/i);n&&(this.os.dd=!0),h||n||e||(this.os.h5=!0)}).call(t,navigator.userAgent)}function a(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function e(t,i,s,a,e,h){for(var n=e/i,c=h/s,o=a,r=0;r<e;r+=1)for(var l=0;l<h;l+=1)!function(a,h){var r=Math.min(i-1,a/n),l=Math.min(s-1,h/c),v=Math.floor(r),u=Math.floor(l),d=h*e+a,g=u*i+v;d*=4,g*=4;for(var f=0;f<=3;f+=1)o[d+f]=t[g+f]}(r,l)}function h(t,i){return e(t.data,t.width,t.height,i.data,i.width,i.height),i}function n(t,i,s,a,e){var h=a,n=e;h>=s?h=s-1:h<0&&(h=0),n>=i?n=i-1:n<0&&(n=0);var c=h*i+n;return c*=4,[t[c+0],t[c+1],t[c+2],t[c+3]]}function c(t,i,s,a,e,h){for(var c=e/i,o=h/s,r=a,l=0;l<e;l+=1)for(var v=0;v<h;v+=1)!function(a,h){var l=Math.min(i-1,a/c),v=Math.min(s-1,h/o),u=Math.floor(l),d=Math.floor(v),g=l-u,f=v-d,p=1-g,m=1-f,w=h*e+a;w*=4;for(var x=n(t,i,s,d+0,u+0),F=n(t,i,s,d+0,u+1),R=n(t,i,s,d+1,u+0),M=n(t,i,s,d+1,u+1),T=0;T<=3;T+=1){var S=f*(p*R[T]+g*M[T]),y=m*(p*x[T]+g*F[T]);r[w+T]=S+y}}(l,v)}function o(t,i){return c(t.data,t.width,t.height,i.data,i.width,i.height),i}function r(t,i,s,a,e,h){for(var n=a,c=e/i,o=h/s,r=0;r<e;r+=1)for(var l=0;l<h;l+=1)!function(a,h){var r=Math.min(i-1,a/c),l=Math.min(s-1,h/o),v=Math.floor(r),u=Math.floor(l),d=r-v,g=l-u,f=h*e+a;f*=4;for(var p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=0;m<=3;m+=1){for(var w=-1;w<=2;w+=1)for(var x=-1;x<=2;x+=1)p[w+1][x+1]=O(t,i,s,u+w,v+x,m);W(p),n[f+m]=b(A(g,d))}}(r,l)}function l(t,i){return r(t.data,t.width,t.height,i.data,i.width,i.height),i}function v(t){var i=t>=0?t:-t,s=t*t,a=i*s;return i<=1?1-(_+3)*s+(_+2)*a:i<=2?-4*_+8*_*i-5*_*s+_*a:0}function u(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)}function d(t,i,s,a,e){var h=a,n=e;h>=s?h=s-1:h<0&&(h=0),n>=i?n=i-1:n<0&&(n=0);var c=h*i+n;return c*=4,[t[c+0],t[c+1],t[c+2],t[c+3]]}function g(t,i,s,a,e,h){for(var n=a,c=e/i,o=h/s,r=0;r<e;r+=1)for(var l=0;l<h;l+=1)!function(a,h){var r=Math.min(i-1,a/c),l=Math.min(s-1,h/o),g=Math.floor(r),f=Math.floor(l),p=r-g,m=l-f,w=h*e+a;w*=4;for(var x=[0,0,0,0],F=-1;F<=2;F+=1)for(var R=-1;R<=2;R+=1){var M=d(t,i,s,f+F,g+R),T=v(F-m)*v(R-p);x[0]+=M[0]*T,x[1]+=M[1]*T,x[2]+=M[2]*T,x[3]+=M[3]*T}n[w+0]=u(x[0]),n[w+1]=u(x[1]),n[w+2]=u(x[2]),n[w+3]=u(x[3])}(r,l)}function f(t,i){return g(t.data,t.width,t.height,i.data,i.width,i.height),i}var p=function(){function t(t,i){for(var s=0;s<i.length;s++){var a=i[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(i,s,a){return s&&t(i.prototype,s),a&&t(i,a),i}}(),m={container:"#imgclip",img:null,isSmooth:!0,captureRadius:30,quality:.92,mime:"image/jpeg",maxCssHeight:0,sizeTipsStyle:0,compressScaleRatio:1,iphoneFixedRatio:2,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},w=function(){function e(h){a(this,e),s(this),this.options=t({},m,h),this.container=i(this.options.container),this.img=this.options.img,this.domChildren=[],this.events={},this.initCanvas(),this.initClip(),this.initMagnifier(),this.initTransferCanvas(),this.resetClipRect()}return p(e,[{key:"getPixelRatio",value:function(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,s=(window.devicePixelRatio||1)/i;return s*=this.options.compressScaleRatio||1,this.os.ios&&this.os.iphone&&(s*=this.options.iphoneFixedRatio||1),s}},{key:"clear",value:function(){for(var t=this.domChildren&&this.domChildren.length||0,i=0;i<t;i+=1)this.container.removeChild(this.domChildren[i]);this.domChildren=null;for(var s=Object.keys(this.events||{}),a=s&&s.length||0,e=0;e<a;e+=1)this.container.removeEventListener(s[e],this.events[s[e]]);this.events=null}},{key:"initCanvas",value:function(){this.canvasFull=document.createElement("canvas"),this.ctxFull=this.canvasFull.getContext("2d"),this.canvasFull.className="clip-canvas-full",this.smoothCtx(this.ctxFull),this.RATIO_PIXEL=this.getPixelRatio(this.ctxFull);var t=this.img.width/this.img.height,i=this.container.offsetWidth||window.innerWidth;this.oldWidth=i,this.oldHeight=i/t,this.resizeCanvas(i,this.oldHeight),this.container.appendChild(this.canvasFull),this.domChildren.push(this.canvasFull)}},{key:"resizeCanvas",value:function(t,i){var s=this.options.maxCssHeight,a=t/i,e=this.oldWidth,h=e/a;s&&h>s&&(e=(h=s)*a),this.marginLeft=(this.oldWidth-e)/2,this.canvasFull.style.width=e+"px",this.canvasFull.style.height=h+"px",this.canvasFull.style.marginLeft=this.marginLeft+"px",this.canvasFull.width=e*this.RATIO_PIXEL,this.canvasFull.height=h*this.RATIO_PIXEL,1&this.rotateStep?this.scale=this.canvasFull.width/this.img.height:this.scale=this.canvasFull.width/this.img.width}},{key:"initClip",value:function(){var t=document.createElement("div");t.className="clip-rect",this.clipRect=t,this.container.appendChild(this.clipRect),this.domChildren.push(this.clipRect);var i=document.createElement("span");i.className="clip-tips",this.clipRect.appendChild(i),this.clipTips=i,-1!==this.options.sizeTipsStyle&&0!==this.options.sizeTipsStyle||this.clipTips.classList.add("clip-hidden"),this.clipRectHorns=[];for(var s=0;s<8;s+=1){var a=document.createElement("span");a.className="clip-rect-horn ",0===s?a.className+="horn-nw":1===s?a.className+="horn-ne":2===s?a.className+="horn-sw":3===s?a.className+="horn-se":4===s?a.className+="horn-n":5===s?a.className+="horn-s":6===s?a.className+="horn-w":7===s&&(a.className+="horn-e"),this.clipRect.appendChild(a),this.clipRectHorns.push(a)}this.resizeClip()}},{key:"resizeClip",value:function(){var t=this;this.clipEventState={};var i=function(i){t.clipEventState.width=t.clipRect.offsetWidth,t.clipEventState.height=t.clipRect.offsetHeight,t.clipEventState.left=t.clipRect.offsetLeft-t.marginLeft,t.clipEventState.top=t.clipRect.offsetTop,t.clipEventState.mouseX=i.touches?i.touches[0].pageX:i.pageX,t.clipEventState.mouseY=i.touches?i.touches[0].pageY:i.pageY,t.clipEventState.evnt=i},s=function(i,s){var a=s-t.canvasFull.offsetTop-t.container.offsetTop,e=i-t.canvasFull.offsetLeft-t.container.offsetLeft;return a=Math.min(a,t.canvasFull.offsetHeight),a=Math.max(0,a),e=Math.min(e,t.canvasFull.offsetWidth),e=Math.max(0,e),t.curX=e,t.curY=a,{curX:e,curY:a}},a=function(i){if(t.canResizing){i.preventDefault(),i.stopPropagation();var a=t.clipEventState,e=a.evnt.target,h=i.touches?i.touches[0].pageY:i.pageY,n=i.touches?i.touches[0].pageX:i.pageX,c=s(n,h),o=c.curX,r=c.curY,l=void 0,v=void 0,u=void 0,d=void 0;e.classList.contains("horn-nw")?(l=a.width-(o-a.left),v=a.height-(r-a.top),u=o,d=r):e.classList.contains("horn-ne")?(l=o-a.left,v=a.height-(r-a.top),u=a.left,d=r):e.classList.contains("horn-sw")?(l=a.width-(o-a.left),v=r-a.top,u=o,d=a.top):e.classList.contains("horn-se")?(l=o-a.left,v=r-a.top,u=a.left,d=a.top):e.classList.contains("horn-n")?(l=a.width,v=a.height-(r-a.top),u=a.left,d=r):e.classList.contains("horn-s")?(l=a.width,v=r-a.top,u=a.left,d=a.top):e.classList.contains("horn-w")?(l=a.width-(o-a.left),v=a.height,u=o,d=a.top):e.classList.contains("horn-e")&&(l=o-a.left,v=a.height,u=o-l,d=a.top),t.clipRect.style.left=u+t.marginLeft+"px",t.clipRect.style.top=d+"px",t.clipRect.style.width=l+"px",t.clipRect.style.height=v+"px",t.draw()}};this.container.addEventListener("touchmove",a),this.container.addEventListener("mousemove",a),this.events.touchmove=a,this.events.mousemove=a;for(var e=function(s){t.canResizing=!0,t.canvasMag.classList.remove("clip-hidden"),0===t.options.sizeTipsStyle&&t.clipTips.classList.remove("clip-hidden"),i(s)},h=function(){t.canResizing=!1,t.canvasMag.classList.add("clip-hidden"),0===t.options.sizeTipsStyle&&t.clipTips.classList.add("clip-hidden")},n=0;n<8;n+=1)this.clipRectHorns[n].addEventListener("mousedown",e),this.clipRectHorns[n].addEventListener("touchstart",e),this.clipRectHorns[n].addEventListener("mouseup",h),this.clipRectHorns[n].addEventListener("touchend",h);this.container.addEventListener("mouseleave",h),this.container.addEventListener("mouseup",h),this.events.mouseleave=h,this.events.mouseup=h}},{key:"draw",value:function(){this.drawMag();var t=this.getRealFinalImgSize(this.clipRect.offsetWidth*this.RATIO_PIXEL,this.clipRect.offsetHeight*this.RATIO_PIXEL),i=t.width,s=t.height;this.clipTips.innerText=i.toFixed(0)+"*"+s.toFixed(0),this.ctxFull.save(),1&this.rotateStep?this.ctxFull.clearRect(0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.clearRect(0,0,this.canvasFull.width,this.canvasFull.height),this.drawImage(),this.drawMask(),this.ctxFull.beginPath();var a=this.getClipRectParams(),e=a.srcX,h=a.srcY,n=a.sWidth,c=a.sHeight;this.ctxFull.rect(e,h,n,c),this.ctxFull.clip(),this.drawImage(),this.ctxFull.restore()}},{key:"getClipRectParams",value:function(){var t=this.clipRect.offsetTop,i=this.clipRect.offsetLeft-this.marginLeft,s=this.clipRect.offsetWidth,a=this.clipRect.offsetHeight,e=i+s,h=t+a,n=i,c=t,o=s,r=a;return 1===this.rotateStep?(n=t,c=this.canvasFull.offsetWidth-e,o=a,r=s):2===this.rotateStep?(n=this.canvasFull.offsetWidth-e,c=this.canvasFull.offsetHeight-h,o=s,r=a):3===this.rotateStep&&(n=this.canvasFull.offsetHeight-h,c=i,o=a,r=s),n*=this.RATIO_PIXEL,c*=this.RATIO_PIXEL,o*=this.RATIO_PIXEL,r*=this.RATIO_PIXEL,{srcX:n,srcY:c,sWidth:o,sHeight:r}}},{key:"getRealCoordinate",value:function(t,i){var s=t,a=i;return 1===this.rotateStep?(s=i,a=this.canvasFull.offsetWidth-t):2===this.rotateStep?(s=this.canvasFull.offsetWidth-t,a=this.canvasFull.offsetHeight-i):3===this.rotateStep&&(s=this.canvasFull.offsetHeight-i,a=t),s*=this.RATIO_PIXEL,a*=this.RATIO_PIXEL,{x:s,y:a}}},{key:"drawImage",value:function(){1&this.rotateStep?this.ctxFull.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvasFull.width,this.canvasFull.height)}},{key:"drawMask",value:function(){this.ctxFull.save(),this.ctxFull.fillStyle="rgba(0, 0, 0, 0.3)",1&this.rotateStep?this.ctxFull.fillRect(0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.fillRect(0,0,this.canvasFull.width,this.canvasFull.height),this.ctxFull.restore()}},{key:"drawMag",value:function(){var t=this.options.captureRadius,i=this.getRealCoordinate(this.curX,this.curY),s=2*t,a=2*t,e=i.x-t,h=i.y-t;1&this.rotateStep?this.ctxMag.clearRect(0,0,this.canvasMag.height,this.canvasMag.width):this.ctxMag.clearRect(0,0,this.canvasMag.width,this.canvasMag.height);var n=0,c=0;this.os.ios&&(h<0&&(c=this.canvasMag.height/2*Math.abs(h/t),h=0),e<0&&(n=this.canvasMag.width/2*Math.abs(e/t),e=0)),this.ctxMag.drawImage(this.img,e/this.scale,h/this.scale,s/this.scale,a/this.scale,n,c,this.canvasMag.width,this.canvasMag.height);var o=this.canvasMag.width/2,r=this.canvasMag.height/2,l=5*this.RATIO_PIXEL;this.ctxMag.beginPath(),this.ctxMag.moveTo(o-l,r),this.ctxMag.lineTo(o+l,r),this.ctxMag.moveTo(o,r-l),this.ctxMag.lineTo(o,r+l),this.ctxMag.strokeStyle="#de3c50",this.ctxMag.lineWidth=3,this.ctxMag.stroke()}},{key:"initMagnifier",value:function(){this.canvasMag=document.createElement("canvas"),this.canvasMag.className="magnifier clip-hidden",this.ctxMag=this.canvasMag.getContext("2d"),this.smoothCtx(this.ctxMag),this.container.appendChild(this.canvasMag),this.domChildren.push(this.canvasMag),this.canvasMag.width=2*this.options.captureRadius*this.RATIO_PIXEL,this.canvasMag.height=2*this.options.captureRadius*this.RATIO_PIXEL}},{key:"initTransferCanvas",value:function(){this.canvasTransfer=document.createElement("canvas"),this.canvasTransfer.style.display="none",this.canvasTransfer.className="transfer-canvas",this.ctxTransfer=this.canvasTransfer.getContext("2d"),this.smoothCtx(this.ctxTransfer),this.container.appendChild(this.canvasTransfer),this.domChildren.push(this.canvasTransfer)}},{key:"smoothCtx",value:function(t){var i=this.options.isSmooth;t.mozImageSmoothingEnabled=i,t.webkitImageSmoothingEnabled=i,t.msImageSmoothingEnabled=i,t.imageSmoothingEnabled=i}},{key:"getRealFinalImgSize",value:function(t,i){var s=this.canvasFull.width/this.canvasFull.height,a=this.options.maxWidth||0,e=this.options.forceWidth||0,h=this.options.forceHeight||0,n=t,c=i;return 1&this.rotateStep?((this.options.isUseOriginSize||this.canvasFull.width>this.img.height)&&(n=this.img.width*t/this.canvasFull.height,c=this.img.height*i/this.canvasFull.width),a&&this.canvasFull.height>a&&a<this.img.height&&(n=a*t/this.canvasFull.height,c=a/s*i/this.canvasFull.width),e&&(n=e*t/this.canvasFull.height,c=(h||e/s)*i/this.canvasFull.width)):((this.options.isUseOriginSize||this.canvasFull.width>this.img.width)&&(n=this.img.width*t/this.canvasFull.width,c=this.img.height*i/this.canvasFull.height),a&&this.canvasFull.width>a&&a<this.img.width&&(n=a*t/this.canvasFull.width,c=a/s*i/this.canvasFull.height),e&&(n=e*t/this.canvasFull.width,c=(h||e/s)*i/this.canvasFull.height)),{width:n,height:c}}},{key:"clip",value:function(){var t=this.getClipRectParams(),i=t.srcX,s=t.srcY,a=t.sWidth,e=t.sHeight,h=this.getRealFinalImgSize(a,e),n=h.width,c=h.height;this.rotateStep=this.rotateStep||0;var o=90*this.rotateStep*Math.PI/180;0===this.rotateStep?(this.canvasTransfer.width=n,this.canvasTransfer.height=c):1===this.rotateStep?(this.canvasTransfer.width=c,this.canvasTransfer.height=n,this.ctxTransfer.rotate(o),this.ctxTransfer.translate(0,-this.canvasTransfer.width)):2===this.rotateStep?(this.canvasTransfer.width=n,this.canvasTransfer.height=c,this.ctxTransfer.rotate(o),this.ctxTransfer.translate(-this.canvasTransfer.width,-this.canvasTransfer.height)):3===this.rotateStep&&(this.canvasTransfer.width=c,this.canvasTransfer.height=n,this.ctxTransfer.rotate(o),this.ctxTransfer.translate(-this.canvasTransfer.height,0)),1&this.rotateStep?this.ctxTransfer.drawImage(this.img,i/this.scale,s/this.scale,a/this.scale,e/this.scale,0,0,this.canvasTransfer.height,this.canvasTransfer.width):this.ctxTransfer.drawImage(this.img,i/this.scale,s/this.scale,a/this.scale,e/this.scale,0,0,this.canvasTransfer.width,this.canvasTransfer.height),this.clipImgData=this.canvasTransfer.toDataURL(this.options.mime,this.options.quality)}},{key:"resetClipRect",value:function(){this.clipRect.style.left=(this.marginLeft||0)+"px",this.clipRect.style.top=0,this.clipRect.style.width=this.canvasFull.width/this.RATIO_PIXEL+"px",this.clipRect.style.height=this.canvasFull.height/this.RATIO_PIXEL+"px",this.draw()}},{key:"getClipImgData",value:function(){return this.clipImgData}},{key:"rotate",value:function(t){var i=this.oldWidth,s=this.oldHeight;this.rotateStep=this.rotateStep||0,this.rotateStep+=t?1:-1,this.rotateStep>3?this.rotateStep=0:this.rotateStep<0&&(this.rotateStep=3);var a=90*this.rotateStep*Math.PI/180;this.canvasMag.width=this.canvasMag.width,this.canvasMag.height=this.canvasMag.height,0===this.rotateStep?this.resizeCanvas(i,s):1===this.rotateStep?(this.resizeCanvas(s,i),this.ctxFull.rotate(a),this.ctxFull.translate(0,-this.canvasFull.width),this.ctxMag.rotate(a),this.ctxMag.translate(0,-this.canvasMag.width)):2===this.rotateStep?(this.resizeCanvas(i,s),this.ctxFull.rotate(a),this.ctxFull.translate(-this.canvasFull.width,-this.canvasFull.height),this.ctxMag.rotate(a),this.ctxMag.translate(-this.canvasMag.width,-this.canvasMag.height)):3===this.rotateStep&&(this.resizeCanvas(s,i),this.ctxFull.rotate(a),this.ctxFull.translate(-this.canvasFull.height,0),this.ctxMag.rotate(a),this.ctxMag.translate(-this.canvasMag.height,0)),this.resetClipRect()}},{key:"destroy",value:function(){this.clear(),this.canvasFull=null,this.ctxFull=null,this.canvasTransfer=null,this.ctxTransfer=null,this.canvasMag=null,this.ctxMag=null,this.clipRect=null}}]),e}(),x=void 0,F=void 0,R=void 0,M=void 0,T=void 0,S=void 0,y=void 0,I=void 0,C=void 0,L=void 0,E=void 0,k=void 0,P=void 0,X=void 0,H=void 0,z=void 0,O=function(t,i,s,a,e,h){var n=a,c=e;n>=s?n=s-1:n<0&&(n=0),c>=i?c=i-1:c<0&&(c=0);var o=n*i+c;return o*=4,t[o+h]},b=function(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)},W=function(t){var i=t;x=i[1][1],F=-.5*i[1][0]+.5*i[1][2],R=i[1][0]-2.5*i[1][1]+2*i[1][2]-.5*i[1][3],M=-.5*i[1][0]+1.5*i[1][1]-1.5*i[1][2]+.5*i[1][3],T=-.5*i[0][1]+.5*i[2][1],S=.25*i[0][0]-.25*i[0][2]-.25*i[2][0]+.25*i[2][2],y=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+.5*i[2][0]-1.25*i[2][1]+i[2][2]-.25*i[2][3],I=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.25*i[2][0]+.75*i[2][1]-.75*i[2][2]+.25*i[2][3],C=i[0][1]-2.5*i[1][1]+2*i[2][1]-.5*i[3][1],L=-.5*i[0][0]+.5*i[0][2]+1.25*i[1][0]-1.25*i[1][2]-i[2][0]+i[2][2]+.25*i[3][0]-.25*i[3][2],E=i[0][0]-2.5*i[0][1]+2*i[0][2]-.5*i[0][3]-2.5*i[1][0]+6.25*i[1][1]-5*i[1][2]+1.25*i[1][3]+2*i[2][0]-5*i[2][1]+4*i[2][2]-i[2][3]-.5*i[3][0]+1.25*i[3][1]-i[3][2]+.25*i[3][3],k=-.5*i[0][0]+1.5*i[0][1]-1.5*i[0][2]+.5*i[0][3]+1.25*i[1][0]-3.75*i[1][1]+3.75*i[1][2]-1.25*i[1][3]-i[2][0]+3*i[2][1]-3*i[2][2]+i[2][3]+.25*i[3][0]-.75*i[3][1]+.75*i[3][2]-.25*i[3][3],P=-.5*i[0][1]+1.5*i[1][1]-1.5*i[2][1]+.5*i[3][1],X=.25*i[0][0]-.25*i[0][2]-.75*i[1][0]+.75*i[1][2]+.75*i[2][0]-.75*i[2][2]-.25*i[3][0]+.25*i[3][2],H=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+1.5*i[1][0]-3.75*i[1][1]+3*i[1][2]-.75*i[1][3]-1.5*i[2][0]+3.75*i[2][1]-3*i[2][2]+.75*i[2][3]+.5*i[3][0]-1.25*i[3][1]+i[3][2]-.25*i[3][3],z=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.75*i[1][0]+2.25*i[1][1]-2.25*i[1][2]+.75*i[1][3]+.75*i[2][0]-2.25*i[2][1]+2.25*i[2][2]-.75*i[2][3]-.25*i[3][0]+.75*i[3][1]-.75*i[3][2]+.25*i[3][3]},A=function(t,i){var s=t*t,a=i*i,e=a*i;return x+F*i+R*a+M*e+(T+S*i+y*a+I*e)*t+(C+L*i+E*a+k*e)*s+(P+X*i+H*a+z*e)*(s*t)},_=-1,N={width:80,height:80,mime:"image/png",processType:1},D={};return function(i){var s=i;s.scaleImageData=function(i,s,a){(0,[h,o,l,f][t({},N,a).processType])(i,s)},s.scaleImage=function(i,a){var e=i.width,h=i.height,n=t({},N,a),c=document.createElement("canvas"),o=c.getContext("2d");c.width=e,c.height=h,o.drawImage(i,0,0,e,h);var r=o.getImageData(0,0,e,h),l=o.createImageData(n.width,n.height);return s.scaleImageData(r,l,n),c.width=l.width,c.height=l.height,o.putImageData(l,0,0,0,0,c.width,c.height),c.toDataURL(n.mime,.9)}}(D),D.ImgClip=w,D});